{"openapi":"3.0.0","paths":{"/api/sse":{"get":{"operationId":"SseController_sse","parameters":[],"responses":{"200":{"description":""}},"tags":["Sse"]}},"/api/messages":{"post":{"operationId":"SseController_messages","parameters":[],"responses":{"201":{"description":""}},"tags":["Sse"]}},"/api/accounts":{"get":{"operationId":"AccountController_findAll","parameters":[],"responses":{"200":{"description":"A list of accounts associated with the user.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListAccountsResponseDto"}}}}},"security":[{"bearer":[]}],"summary":"List all accounts for the current user","tags":["Accounts"]}},"/api/users":{"get":{"description":"Retrieve a list of all users in the system","operationId":"UserController_findAll","parameters":[],"responses":{"200":{"description":""}},"summary":"Get all users","tags":["User Management"]}},"/api/users/{id}":{"get":{"description":"Retrieve a specific user by their unique identifier","operationId":"UserController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}},{"name":"page","required":false,"in":"query","description":"Page number (1-based)","schema":{"minimum":1,"default":1,"example":1,"type":"number"}},{"name":"limit","required":false,"in":"query","description":"Number of items per page","schema":{"minimum":1,"maximum":2000,"default":10,"example":10,"type":"number"}},{"name":"relations","required":false,"in":"query","description":"Relations to include in the response. Use dot notation for nested relations.","schema":{"example":["company","company.accounts"],"type":"array","items":{"type":"string"}}},{"name":"select","required":false,"in":"query","description":"Fields to select in the response","schema":{"example":["id","email","firstName","lastName"],"type":"array","items":{"type":"string"}}},{"name":"sort","required":false,"in":"query","description":"Sort configuration. Can be a single field or multiple fields.","schema":{"type":"array","items":{"$ref":"#/components/schemas/SortField"}}},{"name":"filters","required":false,"in":"query","description":"Filter conditions as JSON object","schema":{"$ref":"#/components/schemas/Object"}}],"responses":{"200":{"description":""}},"summary":"Get user by ID","tags":["User Management"]}},"/api/inbox/{id}":{"get":{"description":"Gets an inbox by id","operationId":"InboxController_getInbox","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Get inbox","tags":["Inbox Management"]},"delete":{"description":"Deletes an inbox","operationId":"InboxController_deleteInbox","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Delete inbox","tags":["Inbox Management"]}},"/api/conversations/search":{"post":{"description":"Use this endpoint for complex custom field queries instead of GET with query parameters. Supports nested JSON paths and includes unread message counts.","operationId":"ConversationController_search","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomFieldQueryRequest"}}}},"responses":{"200":{"description":""}},"summary":"Search conversations with custom field filters (POST for complex queries)","tags":["Conversations"]}},"/api/conversations/{id}":{"get":{"operationId":"ConversationController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Get a conversation by ID","tags":["Conversations"]},"patch":{"operationId":"ConversationController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateConversationDto"}}}},"responses":{"200":{"description":""}},"summary":"Update a conversation","tags":["Conversations"]}},"/api/conversation-messages/search":{"post":{"description":"Use this endpoint for complex queries instead of GET with query parameters.","operationId":"ConversationMessageController_search","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BaseQueryRequest"}}}},"responses":{"200":{"description":""}},"summary":"Search conversation messages (POST for complex queries)","tags":["Conversation Messages"]}},"/api/conversation-messages":{"post":{"description":"Sends a message to a conversation using the channel processor","operationId":"ConversationMessageController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateConversationMessageDto"}}}},"responses":{"201":{"description":""}},"summary":"Send a message to a conversation","tags":["Conversation Messages"]}},"/api/bots":{"get":{"operationId":"BotController_findAll","parameters":[{"name":"page","required":false,"in":"query","description":"Page number (1-based)","schema":{"minimum":1,"default":1,"example":1,"type":"number"}},{"name":"limit","required":false,"in":"query","description":"Number of items per page","schema":{"minimum":1,"maximum":2000,"default":10,"example":10,"type":"number"}},{"name":"relations","required":false,"in":"query","description":"Relations to include in the response. Use dot notation for nested relations.","schema":{"example":["company","company.accounts"],"type":"array","items":{"type":"string"}}},{"name":"select","required":false,"in":"query","description":"Fields to select in the response","schema":{"example":["id","email","firstName","lastName"],"type":"array","items":{"type":"string"}}},{"name":"sort","required":false,"in":"query","description":"Sort configuration. Can be a single field or multiple fields.","schema":{"type":"array","items":{"$ref":"#/components/schemas/SortField"}}},{"name":"filters","required":false,"in":"query","description":"Filter conditions as JSON object","schema":{"$ref":"#/components/schemas/Object"}}],"responses":{"200":{"description":""}},"summary":"Get all bots for the active account","tags":["Bot"]},"post":{"operationId":"BotController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrUpdateBotDto"}}}},"responses":{"201":{"description":""}},"summary":"Create a new bot","tags":["Bot"]}},"/api/bots/{id}":{"get":{"operationId":"BotController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Get a bot by ID","tags":["Bot"]},"put":{"operationId":"BotController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrUpdateBotDto"}}}},"responses":{"200":{"description":""}},"summary":"Update a bot","tags":["Bot"]},"delete":{"operationId":"BotController_delete","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Delete a bot","tags":["Bot"]}},"/api/contacts/{id}":{"get":{"operationId":"ContactController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Get a contact by ID","tags":["Contacts"]},"patch":{"operationId":"ContactController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateOrCreateContactDto"}}}},"responses":{"200":{"description":""}},"summary":"Update a contact","tags":["Contacts"]},"delete":{"operationId":"ContactController_delete","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Delete a contact and its conversations","tags":["Contacts"]}},"/api/contacts/search":{"post":{"description":"Use this endpoint for complex custom field queries instead of GET with query parameters. Supports nested JSON paths like \"customFields.contactData.lastContactDateTime\".","operationId":"ContactController_search","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomFieldQueryRequest"}}}},"responses":{"200":{"description":""}},"summary":"Search contacts with custom field filters (POST for complex queries)","tags":["Contacts"]}},"/api/contacts":{"post":{"operationId":"ContactController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateOrCreateContactDto"}}}},"responses":{"201":{"description":""}},"summary":"Create a new contact","tags":["Contacts"]}},"/api/custom-field-definitions":{"get":{"operationId":"CustomFieldDefinitionController_findAll","parameters":[{"name":"includeHidden","required":true,"in":"query","schema":{"type":"boolean"}}],"responses":{"200":{"description":""}},"summary":"Get all custom field definitions for account","tags":["Custom Field Definitions"]},"post":{"operationId":"CustomFieldDefinitionController_create","parameters":[],"responses":{"201":{"description":""}},"summary":"Create a new custom field definition","tags":["Custom Field Definitions"]}},"/api/custom-field-definitions/{id}":{"get":{"operationId":"CustomFieldDefinitionController_findById","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Get a custom field definition by ID","tags":["Custom Field Definitions"]},"put":{"operationId":"CustomFieldDefinitionController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Update a custom field definition","tags":["Custom Field Definitions"]},"delete":{"operationId":"CustomFieldDefinitionController_delete","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Delete a custom field definition","tags":["Custom Field Definitions"]}},"/api/custom-field-definitions/scope/{scope}":{"get":{"operationId":"CustomFieldDefinitionController_findByScope","parameters":[],"responses":{"200":{"description":""}},"summary":"Get custom field definitions by scope","tags":["Custom Field Definitions"]}},"/api/knowledge-documents":{"post":{"description":"Upload and process a document to create a new knowledge document with vector embeddings","operationId":"KnowledgeDocumentController_create","parameters":[],"requestBody":{"required":true,"description":"Knowledge document data with file upload","content":{"multipart/form-data":{"schema":{"type":"object","properties":{"file":{"type":"string","format":"binary","description":"The document file to upload (PDF only, max 10MB)"},"name":{"type":"string","description":"Name of the knowledge document","example":"Product Manual v2.1"},"description":{"type":"string","description":"Description of the knowledge document","example":"Comprehensive product manual covering all features"},"type":{"type":"string","enum":["pdf"],"description":"Type of the document","example":"pdf"},"metadata":{"type":"object","description":"Additional metadata for the document","example":{"version":"2.1","category":"product"}}},"required":["file","name","type"]}}}},"responses":{"201":{"description":"Knowledge document created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/KnowledgeDocumentResponseDto"}}}},"400":{"description":"Invalid file type or missing required fields"}},"summary":"Create a new knowledge document","tags":["Knowledge Documents"]},"get":{"description":"Retrieve all knowledge documents belonging to the current account","operationId":"KnowledgeDocumentController_findAll","parameters":[],"responses":{"200":{"description":"Knowledge documents retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/KnowledgeDocumentResponseDto"}}}}}},"summary":"Get all knowledge documents for the account","tags":["Knowledge Documents"]}},"/api/knowledge-documents/query":{"post":{"description":"Search for relevant document chunks using vector similarity search","operationId":"KnowledgeDocumentController_query","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryDocumentsDto"}}}},"responses":{"200":{"description":"Query results returned successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryDocumentsResponseDto"}}}},"400":{"description":"Invalid query parameters"}},"summary":"Query knowledge documents","tags":["Knowledge Documents"]}},"/api/knowledge-documents/bot/{botId}":{"get":{"description":"Retrieve all knowledge documents associated with a specific bot","operationId":"KnowledgeDocumentController_findByBotId","parameters":[{"name":"botId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Knowledge documents retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/KnowledgeDocumentResponseDto"}}}}}},"summary":"Get knowledge documents for a specific bot","tags":["Knowledge Documents"]}},"/api/knowledge-documents/{id}":{"get":{"description":"Retrieve a specific knowledge document by its unique identifier","operationId":"KnowledgeDocumentController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Knowledge document retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/KnowledgeDocumentResponseDto"}}}},"404":{"description":"Knowledge document not found"}},"summary":"Get a knowledge document by ID","tags":["Knowledge Documents"]},"delete":{"description":"Delete a knowledge document and all its associated chunks","operationId":"KnowledgeDocumentController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Knowledge document deleted successfully"},"404":{"description":"Knowledge document not found"}},"summary":"Delete a knowledge document","tags":["Knowledge Documents"]}}},"info":{"title":"Kuantia CRM API","description":"Kuantia CRM API Documentation","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"schemas":{"ListAccountResponseAccountElement":{"type":"object","properties":{"id":{"type":"string","description":"Unique identifier for the account","example":"uuid-123e4567-e89b-12d3-a456-426614174000"},"name":{"type":"string","description":"Display name of the account","example":"Acme Corp Customer Support"},"role":{"type":"string","description":"User role within this account","enum":["admin","user"],"example":"admin"},"createdAt":{"format":"date-time","type":"string","description":"Account creation timestamp","example":"2024-01-15T10:30:00Z"},"updatedAt":{"format":"date-time","type":"string","description":"Last update timestamp","example":"2024-01-20T14:45:00Z"}},"required":["id","name","role","createdAt","updatedAt"]},"ListAccountsResponseDto":{"type":"object","properties":{"accounts":{"description":"List of accounts accessible to the user","type":"array","items":{"$ref":"#/components/schemas/ListAccountResponseAccountElement"}}},"required":["accounts"]},"SortField":{"type":"object","properties":{"field":{"type":"string","description":"Field name to sort by","example":"createdAt"},"order":{"type":"string","description":"Sort order","enum":["ASC","DESC"],"example":"DESC"}}},"Object":{"type":"object","properties":{}},"CustomFieldQueryRequest":{"type":"object","properties":{"page":{"type":"number","description":"Page number (1-based)","minimum":1,"default":1,"example":1},"limit":{"type":"number","description":"Number of items per page","minimum":1,"maximum":2000,"default":10,"example":10},"relations":{"description":"Relations to include in the response. Use dot notation for nested relations.","example":["company","company.accounts"],"type":"array","items":{"type":"string"}},"select":{"description":"Fields to select in the response","example":["id","email","firstName","lastName"],"type":"array","items":{"type":"string"}},"sort":{"description":"Sort configuration. Can be a single field or multiple fields.","example":[{"field":"createdAt","order":"DESC"}],"type":"array","items":{"$ref":"#/components/schemas/SortField"}},"filters":{"type":"object","description":"Filter conditions as JSON object","example":{"company.id":"123e4567-e89b-12d3-a456-426614174000"}},"customFieldFilters":{"type":"object","description":"Filter by custom field values using JSON path queries","example":{"customFields.status":"active","customFields.priority":{"$in":["high","medium"]},"customFields.tags":{"$contains":"urgent"},"customFields.createdDate":{"$gte":"2024-01-01"},"customFields.score":{"$gt":50},"customFields.isActive":{"$exists":true}}},"customFieldSearch":{"type":"string","description":"Search text within custom field values","example":"urgent task"},"customFieldSort":{"type":"string","description":"Sort by custom field (use customFields.fieldName format)","example":"customFields.priority"},"customFieldGroupBy":{"type":"string","description":"Group by custom field (use customFields.fieldName format)","example":"customFields.status"}}},"UpdateConversationDto":{"type":"object","properties":{"disableBotCall":{"type":"boolean","description":"Whether to disable bot calls for this conversation","example":true},"customFields":{"type":"object","description":"Custom fields for the conversation","example":{}}}},"BaseQueryRequest":{"type":"object","properties":{"page":{"type":"number","description":"Page number (1-based)","minimum":1,"default":1,"example":1},"limit":{"type":"number","description":"Number of items per page","minimum":1,"maximum":2000,"default":10,"example":10},"relations":{"description":"Relations to include in the response. Use dot notation for nested relations.","example":["company","company.accounts"],"type":"array","items":{"type":"string"}},"select":{"description":"Fields to select in the response","example":["id","email","firstName","lastName"],"type":"array","items":{"type":"string"}},"sort":{"description":"Sort configuration. Can be a single field or multiple fields.","example":[{"field":"createdAt","order":"DESC"}],"type":"array","items":{"$ref":"#/components/schemas/SortField"}},"filters":{"type":"object","description":"Filter conditions as JSON object","example":{"company.id":"123e4567-e89b-12d3-a456-426614174000"}}}},"CreateConversationMessageDto":{"type":"object","properties":{"conversationId":{"type":"string","description":"The ID of the conversation to send the message to. If not provided, a new conversation will be created."},"message":{"type":"string","description":"The message to send"},"type":{"type":"string","description":"The type of the message","enum":["USER","BOT","NOTE"]},"messageType":{"type":"string","description":"The type of the message","example":"TEXT","enum":["TEXT","IMAGE","AUDIO","VIDEO","FILE"]},"content":{"type":"object","description":"An optional object containing additional metada fields for the message (e.g. text, image, audio). For WhatsApp templates, include template data. For emails, include subject.","additionalProperties":true,"example":{"template":{"name":"hello_world","language":"en_US","components":[]},"subject":"Following up on your inquiry","signatureHtml":"<p>Best regards,<br>John Doe</p>"}},"inboxId":{"type":"string","description":"Required when conversationId is not provided. The ID of the inbox to send the message through."},"contactId":{"type":"string","description":"Required when conversationId is not provided. The ID of the existing contact to send the message to."}},"required":["message","type","messageType","content"]},"CreateOrUpdateBotDto":{"type":"object","properties":{"name":{"type":"string","description":"The name of the bot","example":"My Bot"},"profilePicturePath":{"type":"string","description":"The profile picture path of the bot","example":"https://example.com/profile-picture.png"},"description":{"type":"string","description":"The description of the bot","example":"This is my bot"},"webhookUrl":{"type":"string","description":"The webhook URL of the bot","example":"https://example.com/webhook"},"inboxesIds":{"description":"The inboxes IDs of the bot","example":["123e4567-e89b-12d3-a456-426614174000"],"type":"array","items":{"type":"string"}}},"required":["name","profilePicturePath","description","webhookUrl","inboxesIds"]},"UpdateOrCreateContactDto":{"type":"object","properties":{"id":{"type":"string","description":"Contact ID","example":"123e4567-e89b-12d3-a456-426614174000"},"name":{"type":"string","description":"Contact name","example":"John Doe"},"email":{"type":"string","description":"Contact email address","example":"john.doe@example.com"},"phone":{"type":"string","description":"Contact phone number","example":"+1234567890"},"profilePictureUrl":{"type":"string","description":"Profile picture URL","example":"https://example.com/profile.jpg"},"customFields":{"type":"object","description":"Custom fields for the contact","example":{"customer_type":"enterprise","lead_source":"website","deal_value":75000,"tags":["vip","priority"],"last_contact_date":"2024-01-15T10:30:00Z"}}},"required":["id"]},"KnowledgeDocumentResponseDto":{"type":"object","properties":{"id":{"type":"string","description":"Unique identifier of the knowledge document","example":"123e4567-e89b-12d3-a456-426614174000"},"name":{"type":"string","description":"Name of the knowledge document","example":"Product Manual v2.1"},"description":{"type":"string","description":"Description of the knowledge document","example":"Comprehensive product manual covering all features and troubleshooting","nullable":true},"type":{"type":"string","description":"Type of the document","enum":["pdf"],"example":"pdf"},"filePath":{"type":"string","description":"File path where the document is stored","example":"/uploads/documents/product-manual-v2.1.pdf"},"originalFilename":{"type":"string","description":"Original filename when uploaded","example":"product-manual-v2.1.pdf"},"fileSize":{"type":"number","description":"File size in bytes","example":2048576},"mimeType":{"type":"string","description":"MIME type of the file","example":"application/pdf"},"chunkCount":{"type":"number","description":"Number of chunks this document was split into","example":15},"tokenCount":{"type":"number","description":"Total number of tokens in the document","example":2500},"metadata":{"type":"object","description":"Additional metadata for the document","example":{"version":"2.1","category":"product","tags":["manual","troubleshooting"]},"nullable":true},"accountId":{"type":"string","description":"Account ID that owns this document","example":"123e4567-e89b-12d3-a456-426614174000"},"createdAt":{"format":"date-time","type":"string","description":"Creation timestamp","example":"2024-01-15T10:30:00Z"},"updatedAt":{"format":"date-time","type":"string","description":"Last update timestamp","example":"2024-01-15T10:30:00Z"}},"required":["id","name","description","type","filePath","originalFilename","fileSize","mimeType","chunkCount","tokenCount","metadata","accountId","createdAt","updatedAt"]},"QueryDocumentsDto":{"type":"object","properties":{"query":{"type":"string","description":"Query string to search for in the knowledge documents","example":"How to configure the payment settings?","minLength":1,"maxLength":1000},"botId":{"type":"string","description":"Bot ID to filter documents by","example":"123e4567-e89b-12d3-a456-426614174000"},"accountId":{"type":"string","description":"Account ID to filter documents by (optional)","example":"123e4567-e89b-12d3-a456-426614174000"},"limit":{"type":"number","description":"Maximum number of results to return","example":5,"minimum":1,"maximum":20,"default":5}},"required":["query","botId"]},"KnowledgeDocumentChunkResponseDto":{"type":"object","properties":{"id":{"type":"string","description":"Unique identifier of the chunk","example":"123e4567-e89b-12d3-a456-426614174000"},"documentId":{"type":"string","description":"Document ID this chunk belongs to","example":"123e4567-e89b-12d3-a456-426614174000"},"chunkIndex":{"type":"number","description":"Sequential index of this chunk within the document","example":3},"content":{"type":"string","description":"The text content of this chunk","example":"This section covers the payment configuration settings..."},"tokenCount":{"type":"number","description":"Number of tokens in this chunk","example":150},"startPosition":{"type":"number","description":"Start position of this chunk in the original document","example":1250},"endPosition":{"type":"number","description":"End position of this chunk in the original document","example":1850},"metadata":{"type":"object","description":"Additional metadata for this chunk","example":{"page":3,"section":"Payment Configuration"},"nullable":true},"createdAt":{"format":"date-time","type":"string","description":"Creation timestamp","example":"2024-01-15T10:30:00Z"},"updatedAt":{"format":"date-time","type":"string","description":"Last update timestamp","example":"2024-01-15T10:30:00Z"}},"required":["id","documentId","chunkIndex","content","tokenCount","startPosition","endPosition","metadata","createdAt","updatedAt"]},"QueryDocumentsResponseDto":{"type":"object","properties":{"chunks":{"description":"Array of matching document chunks","type":"array","items":{"$ref":"#/components/schemas/KnowledgeDocumentChunkResponseDto"}},"totalCount":{"type":"number","description":"Total number of chunks found","example":5},"query":{"type":"string","description":"The original query string","example":"How to configure the payment settings?"}},"required":["chunks","totalCount","query"]}}}}